<script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha256.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/enc-base64-min.js"></script>
<script src="//js.pusher.com/2.2/pusher.min.js"></script>
<script>
  // If your Heroku application is within the EU region,
  // uncomment the followling lines
  // Pusher.host = 'ws-eu.pusher.com';
  // Pusher.sockjs_host = 'sockjs-eu.pusher.com';

  var token_id = '3';
  // var secret = 'Ve7JCHPpp0qhYC4nkECdV32tJ+88cMGV7yqW1bVi5LqMWH+BiUkNVO4DpBwBSR17Ibp8kTy19+EMG3E6hLn19Q==';
  var secret = 'rm87+7DCoYgopmSAAzYR9/+L7ASyy0Ssb9SHysilWM1zufhZPwm3XsKvaylLRVEEgbKQwkFWUW8gUKNrA6YgnQ==';
  var data = {
    "sub": token_id,
    "jti": Date.now()
  };

  function base64url(source) {
    // Encode in classical base64
    encodedSource = CryptoJS.enc.Base64.stringify(source);

    // Remove padding equal characters
    encodedSource = encodedSource.replace(/=+$/, '');

    // Replace characters according to base64url specifications
    encodedSource = encodedSource.replace(/\+/g, '-');
    encodedSource = encodedSource.replace(/\//g, '_');

    return encodedSource;
  }

  var header = {
    "typ": "JWT",
    "alg": "HS256"
  };

  // encode header
  var stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
  var encodedHeader = base64url(stringifiedHeader);

  // encode data
  var stringifiedData = CryptoJS.enc.Utf8.parse(JSON.stringify(data));
  var encodedData = base64url(stringifiedData);

  // build token
  var token = encodedHeader + "." + encodedData;

  // sign token
  var signature = CryptoJS.HmacSHA256(token, secret);
  signature = base64url(signature);
  var signedToken = token + "." + signature;


  var pusher = new Pusher('112da5ecf39968cbb761', {
    authEndpoint: 'https://api.pnlex.com/pusher/auth',
    auth: {
      headers: {
        'Authorization': 'Bearer ' + signedToken
      }
    }
  });
  var channel = pusher.subscribe('private-user_3');
  channel.bind('create', function (data) {
    console.log(data);
  });
  channel.bind('pusher:subscription_succeeded', function() {
      console.log('success');
  });
</script>